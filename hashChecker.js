const express = require('express');
const sqlite3 = require('sqlite3').verbose();

const app = express();
const dbFile = "./HashDB";
const db = new sqlite3.Database(dbFile);

app.get('/api/check-hash/:hash', (req, res) => {
    const targetHash = req.params.hash;

    const query = `SELECT hash, name FROM HashDB WHERE hash = ?`;
    db.get(query, [targetHash], (err, row) => {
        if (err) {
            console.error("Error:", err);
            res.status(500).json({ error: "An error occurred" });
            return;
        }
        
        if (row) {
            res.json({
                found: true,
                hash: row.hash,
                name: row.name
            });
        } else {
            res.json({ found: false });
        }
    });
});

// New route to retrieve all records
app.get('/api/all-records', (req, res) => {
    const query = `SELECT hash, name FROM HashDB`;
    db.all(query, (err, rows) => {
        if (err) {
            console.error("Error:", err);
            res.status(500).json({ error: "An error occurred" });
            return;
        }

        res.json(rows);
    });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});
